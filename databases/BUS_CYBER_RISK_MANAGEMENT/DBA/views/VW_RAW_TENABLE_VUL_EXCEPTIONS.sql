create or replace view VW_RAW_TENABLE_VUL_EXCEPTIONS(
	RAW_TENABLE_VUL_ID,
	ACCEPT_RISK_RULE_COMMENT,
	ACCEPTRISK,
	ACRSCORE,
	APPLICABILITYCODE,
	ASSET_ID_TATTOO,
	ASSETEXPOSURESCORE,
	AWS_ACCOUNTID,
	AWS_INSTANCE_ID,
	BASESCORE,
	BID,
	CHECKTYPE,
	COMPLIANCE_ACTUAL_VALUE,
	COMPLIANCE_CHECK_NAME,
	COMPLIANCE_ERROR,
	COMPLIANCE_RESULT,
	CPE,
	CREDENTIALED_SCAN,
	CUSTOM_SEVERITY,
	CVE,
	CVSSV2BASESCORE,
	CVSSV3BASESCORE,
	CVSSV3TEMPORALSCORE,
	CVSSV3VECTOR,
	CVSSVECTOR,
	DATA_ERROR_ARRAY,
	DATA_WARNING_ARRAY,
	DATACENTER_ID,
	DATECOMPLETED,
	DESCRIPTION,
	DNSNAME,
	DW_ASSET_ID,
	DW_DUP_NUMBER,
	DW_VUL_ID,
	EXPLOIT_AVAILABLE,
	EXPLOITEASE,
	EXPLOITFRAMEWORKS,
	FAMILY_ID,
	FAMILY_NAME,
	FAMILY_TYPE,
	FIRST_SEEN,
	FISMASEVERITY,
	HAS_BEEN_MITIGATED,
	HOSTNAME,
	HOSTUNIQUENESS,
	HOSTUUID,
	INSERT_DATE,
	IP,
	IPS,
	IS_PRIMARY_FISMA_ID_DEFAULTED_TO_DC,
	KEYDRIVERS,
	LAST_SEEN,
	MACADDRESS,
	MITIGATIONSTATUS,
	NETBIOSNAME,
	NUMERIC_SEVERITY,
	OPERATING_SYSTEM,
	PATCHPUB_DATE,
	PLUGIN_ID,
	PLUGIN_INFO,
	PLUGIN_MOD_DATE,
	PLUGIN_NAME,
	PLUGIN_PUB_DATE,
	PLUGIN_TAGS,
	PLUGINTEXT,
	PORT,
	PRIMARY_FISMA_ID_DERIVED,
	PRIMARY_FISMA_ID_TATTOO,
	PROTOCOL,
	RECASTRISK,
	RECASTRISKRULECOMMENT,
	REPORTDATE,
	REPOSITORY_DATAFORMAT,
	REPOSITORY_DESCRIPTION,
	REPOSITORY_ID,
	REPOSITORY_NAME,
	RISKFACTOR,
	ROWDISPOSITION,
	SCAN_POLICY_NAME,
	SCAN_POLICY_UID,
	SCAN_START_DATE,
	SEEALSO,
	SEVERITY_DESCRIPTION,
	SEVERITY_ID,
	SEVERITY_NAME,
	SNAPSHOT_ID,
	SOLUTION,
	SOURCE_TOOL,
	STATE,
	STIGSEVERITY,
	SYNOPSIS,
	SYSTEM_ACRONYM,
	SYSTEM_ID,
	TEMP_DW_ASSET_ID,
	TEMPORAL_SCORE,
	TENABLEUUID,
	UNIQUENESS,
	VERSION,
	VPR_SCORE,
	VPRCONTEXT,
	VULN_PUB_DATE,
	XREF,
	DATACENTER_ACRONYM,
	DATACATEGORY,
	SNAPSHOT_DATE
) COMMENT='View to report RAW_TENABLE_VUL records that have DATA_ERROR_ARRAY or DATA_WARNING_ARRAY populated (Historical)\t'
 as
SELECT 
 v.RAW_TENABLE_VUL_ID 
,v.ACCEPT_RISK_RULE_COMMENT
,v.ACCEPTRISK
,v.ACRSCORE
,v.APPLICABILITYCODE
,v.ASSET_ID_TATTOO
,v.ASSETEXPOSURESCORE
,v.AWS_ACCOUNTID
,v.AWS_INSTANCE_ID
,v.BASESCORE 
,v.BID
,v.CHECKTYPE
,v.COMPLIANCE_ACTUAL_VALUE
,v.COMPLIANCE_CHECK_NAME
,v.COMPLIANCE_ERROR
,v.COMPLIANCE_RESULT
,v.CPE
,v.CREDENTIALED_SCAN
,v.CUSTOM_SEVERITY
,v.CVE 
,v.CVSSV2BASESCORE 
,v.CVSSV3BASESCORE 
,v.CVSSV3TEMPORALSCORE
,v.CVSSV3VECTOR
,v.CVSSVECTOR
,v.DATA_ERROR_ARRAY 
,v.DATA_WARNING_ARRAY 
,v.DATACENTER_ID
,v.DATECOMPLETED 
,v.DESCRIPTION
,v.DNSNAME
,v.DW_ASSET_ID 
,v.DW_DUP_NUMBER 
,v.DW_VUL_ID 
,v.EXPLOIT_AVAILABLE
,v.EXPLOITEASE
,v.EXPLOITFRAMEWORKS
,v.FAMILY_ID
,v.FAMILY_NAME
,v.FAMILY_TYPE
,v.FIRST_SEEN 
,v.FISMASEVERITY
,v.HAS_BEEN_MITIGATED 
,v.HOSTNAME
,v.HOSTUNIQUENESS
,v.HOSTUUID
,v.INSERT_DATE 
,v.IP
,v.IPS
,v.IS_PRIMARY_FISMA_ID_DEFAULTED_TO_DC 
,v.KEYDRIVERS
,v.LAST_SEEN 
,v.MACADDRESS
,v.MITIGATIONSTATUS
,v.NETBIOSNAME
,v.NUMERIC_SEVERITY 
,v.OPERATING_SYSTEM
,v.PATCHPUB_DATE 
,v.PLUGIN_ID
,v.PLUGIN_INFO
,v.PLUGIN_MOD_DATE 
,v.PLUGIN_NAME
,v.PLUGIN_PUB_DATE 
,v.PLUGIN_TAGS
,v.PLUGINTEXT
,v.PORT
,v.PRIMARY_FISMA_ID_DERIVED
,v.PRIMARY_FISMA_ID_TATTOO
,v.PROTOCOL
,v.RECASTRISK
,v.RECASTRISKRULECOMMENT
,v.REPORTDATE 
,v.REPOSITORY_DATAFORMAT
,v.REPOSITORY_DESCRIPTION
,v.REPOSITORY_ID
,v.REPOSITORY_NAME
,v.RISKFACTOR
,v.ROWDISPOSITION
,v.SCAN_POLICY_NAME
,v.SCAN_POLICY_UID
,v.SCAN_START_DATE 
,v.SEEALSO
,v.SEVERITY_DESCRIPTION
,v.SEVERITY_ID
,v.SEVERITY_NAME
,v.SNAPSHOT_ID 
,v.SOLUTION
,v.SOURCE_TOOL
,v.STATE
,v.STIGSEVERITY
,v.SYNOPSIS
,s.ACRONYM SYSTEM_ACRONYM -- 231023
,v.SYSTEM_ID
,v.TEMP_DW_ASSET_ID 
,v.TEMPORAL_SCORE
,v.TENABLEUUID
,v.UNIQUENESS
,v.VERSION
,v.VPR_SCORE
,v.VPRCONTEXT
,v.VULN_PUB_DATE 
,v.XREF
,dc.ACRONYM DATACENTER_ACRONYM
,snap.datacategory
,snap.snapshot_date
FROM CORE.RAW_TENABLE_VUL v
JOIN CORE.SNAPSHOT_IDS snap on snap.snapshot_id=v.snapshot_id
LEFT JOIN CORE.VW_SYSTEMS dc on dc.SYSTEM_ID=v.DATACENTER_ID
LEFT JOIN CORE.VW_SYSTEMS s on s.SYSTEM_ID=v.SYSTEM_ID -- 231023
where (array_size(v.DATA_ERROR_ARRAY) !=0 or array_size(v.DATA_WARNING_ARRAY) !=0);