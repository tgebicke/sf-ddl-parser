create or replace view VW_RAW_TENABLE_VUL_LIMITED(
	RAW_TENABLE_VUL_ID,
	DATACATEGORY,
	SNAPSHOT_DATE,
	SNAPSHOT_ID,
	DATACENTER_ACRONYM,
	SYSTEM_ACRONYM,
	ACCEPT_RISK_RULE_COMMENT,
	ACCEPTRISK,
	ACRSCORE,
	APPLICABILITYCODE,
	ASSET_ID_TATTOO,
	ASSETEXPOSURESCORE,
	AWS_ACCOUNTID,
	AWS_INSTANCE_ID,
	BASESCORE,
	BID,
	CHECKTYPE,
	COMPLIANCE_ACTUAL_VALUE,
	COMPLIANCE_CHECK_NAME,
	COMPLIANCE_ERROR,
	COMPLIANCE_RESULT,
	CPE,
	CREDENTIALED_SCAN,
	CUSTOM_SEVERITY,
	CVE,
	CVSSV2BASESCORE,
	CVSSV3BASESCORE,
	CVSSV3TEMPORALSCORE,
	CVSSV3VECTOR,
	CVSSVECTOR,
	DATA_ERROR_ARRAY,
	DATA_WARNING_ARRAY,
	DATACENTER_ID,
	DATECOMPLETED,
	DESCRIPTION,
	DNSNAME,
	DW_ASSET_ID,
	DW_DUP_NUMBER,
	DW_VUL_ID,
	EXPLOIT_AVAILABLE,
	EXPLOITEASE,
	EXPLOITFRAMEWORKS,
	FAMILY_ID,
	FAMILY_NAME,
	FAMILY_TYPE,
	FIRST_SEEN,
	FISMASEVERITY,
	HAS_BEEN_MITIGATED,
	HOSTNAME,
	HOSTUNIQUENESS,
	HOSTUUID,
	INSERT_DATE,
	IP,
	IPS,
	IS_PRIMARY_FISMA_ID_DEFAULTED_TO_DC,
	KEYDRIVERS,
	LAST_SEEN,
	MACADDRESS,
	MITIGATIONSTATUS,
	NESSUS_VERSION,
	NETBIOSNAME,
	NUMERIC_SEVERITY,
	OPERATING_SYSTEM,
	PATCHPUB_DATE,
	PLUGIN_ID,
	PLUGIN_INFO,
	PLUGIN_MOD_DATE,
	PLUGIN_NAME,
	PLUGIN_PUB_DATE,
	PLUGIN_TAGS,
	PORT,
	PRIMARY_FISMA_ID_DERIVED,
	PRIMARY_FISMA_ID_TATTOO,
	PROTOCOL,
	RECASTRISK,
	RECASTRISKRULECOMMENT,
	REPORTDATE,
	REPOSITORY_DATAFORMAT,
	REPOSITORY_DESCRIPTION,
	REPOSITORY_ID,
	REPOSITORY_NAME,
	RISKFACTOR,
	ROWDISPOSITION,
	SCAN_POLICY_NAME,
	SCAN_POLICY_UID,
	SCAN_START_DATE,
	SEEALSO,
	SEVERITY_DESCRIPTION,
	SEVERITY_ID,
	SEVERITY_NAME,
	SOLUTION,
	SOURCE_TOOL,
	STATE,
	STIGSEVERITY,
	SYNOPSIS,
	SYSTEM_ID,
	TATTOO_PLUGIN_ASSET_ID,
	TATTOO_PLUGIN_PRIMARY_FISMA_ID,
	TEMP_DW_ASSET_ID,
	TEMPORAL_SCORE,
	TENABLEUUID,
	UNIQUENESS,
	VERSION,
	VPR_SCORE,
	VPRCONTEXT,
	VULN_PUB_DATE,
	XREF
) COMMENT='Diagnostic View to report RAW_TENABLE_VUL but with limited columns. Exlcude cols that cause wrap-around in Excel'
 as
SELECT
r.RAW_TENABLE_VUL_ID
,snap.DATACATEGORY
,snap.SNAPSHOT_DATE::date as SNAPSHOT_DATE
,r.SNAPSHOT_ID
,dc.ACRONYM DATACENTER_ACRONYM
,s.ACRONYM SYSTEM_ACRONYM
,r.ACCEPT_RISK_RULE_COMMENT
,r.ACCEPTRISK
,r.ACRSCORE
,r.APPLICABILITYCODE
,r.ASSET_ID_TATTOO
,r.ASSETEXPOSURESCORE
,r.AWS_ACCOUNTID
,r.AWS_INSTANCE_ID
,r.BASESCORE
,r.BID
,r.CHECKTYPE
,r.COMPLIANCE_ACTUAL_VALUE
,r.COMPLIANCE_CHECK_NAME
,r.COMPLIANCE_ERROR
,r.COMPLIANCE_RESULT
,r.CPE
,r.CREDENTIALED_SCAN
,r.CUSTOM_SEVERITY
,r.CVE
,r.CVSSV2BASESCORE
,r.CVSSV3BASESCORE
,r.CVSSV3TEMPORALSCORE
,r.CVSSV3VECTOR
,r.CVSSVECTOR
,r.DATA_ERROR_ARRAY
,r.DATA_WARNING_ARRAY
,r.DATACENTER_ID
,r.DATECOMPLETED
,r.DESCRIPTION
,r.DNSNAME
,r.DW_ASSET_ID
,r.DW_DUP_NUMBER
,r.DW_VUL_ID
,r.EXPLOIT_AVAILABLE
,r.EXPLOITEASE
,r.EXPLOITFRAMEWORKS
,r.FAMILY_ID
,r.FAMILY_NAME
,r.FAMILY_TYPE
,r.FIRST_SEEN
,r.FISMASEVERITY
,r.HAS_BEEN_MITIGATED
,r.HOSTNAME
,r.HOSTUNIQUENESS
,r.HOSTUUID
,r.INSERT_DATE::date as INSERT_DATE
,r.IP
,r.IPS
,r.IS_PRIMARY_FISMA_ID_DEFAULTED_TO_DC
,r.KEYDRIVERS
,r.LAST_SEEN
,r.MACADDRESS
,r.MITIGATIONSTATUS
,r.NESSUS_VERSION
,r.NETBIOSNAME
,r.NUMERIC_SEVERITY
,r.OPERATING_SYSTEM
,r.PATCHPUB_DATE
,r.PLUGIN_ID
,r.PLUGIN_INFO
,r.PLUGIN_MOD_DATE
,r.PLUGIN_NAME
,r.PLUGIN_PUB_DATE
,r.PLUGIN_TAGS
--,r.PLUGINTEXT -- causes wrap-around in excel
,r.PORT
,r.PRIMARY_FISMA_ID_DERIVED
,r.PRIMARY_FISMA_ID_TATTOO
,r.PROTOCOL
,r.RECASTRISK
,r.RECASTRISKRULECOMMENT
,r.REPORTDATE
,r.REPOSITORY_DATAFORMAT
,r.REPOSITORY_DESCRIPTION
,r.REPOSITORY_ID
,r.REPOSITORY_NAME
,r.RISKFACTOR
,r.ROWDISPOSITION
,r.SCAN_POLICY_NAME
,r.SCAN_POLICY_UID
,r.SCAN_START_DATE
,r.SEEALSO
,r.SEVERITY_DESCRIPTION
,r.SEVERITY_ID
,r.SEVERITY_NAME
,r.SOLUTION
,r.SOURCE_TOOL
,r.STATE
,r.STIGSEVERITY
,r.SYNOPSIS
,r.SYSTEM_ID
,r.TATTOO_PLUGIN_ASSET_ID
,r.TATTOO_PLUGIN_PRIMARY_FISMA_ID
,r.TEMP_DW_ASSET_ID
,r.TEMPORAL_SCORE
,r.TENABLEUUID
,r.UNIQUENESS
,r.VERSION
,r.VPR_SCORE
,r.VPRCONTEXT
,r.VULN_PUB_DATE
,r.XREF
FROM BUS_CYBER_RISK_MANAGEMENT.CORE.RAW_TENABLE_VUL r
JOIN CORE.SNAPSHOT_IDS snap on snap.snapshot_id = r.snapshot_id
LEFT JOIN CORE.VW_SYSTEMS dc on dc.SYSTEM_ID = r.DATACENTER_ID
LEFT JOIN CORE.VW_SYSTEMS s on s.SYSTEM_ID = r.SYSTEM_ID;