create or replace view VW_CFACTS_ALLOCATEDCONTROL(
	ALLOCATION_STATUS,
	CONTROL_ELEMENT,
	CONTROL_ELEMENT_NUMBER,
	CONTROL_FAMILY,
	CONTROL_NAME,
	CONTROL_NUMBER,
	CONTROL_NUMBER_COMBO,
	CONTROL_SET_VERSION_NUMBER,
	HYBRID_CONTROL,
	INHERITABLE_BY_OTHER_SYSTEMS,
	LAST_ACT_DATE,
	LAST_ASSESSMENT_DATE,
	LAST_PENTEST_DATE,
	LAST_SCA_DATE,
	OVERALL_CONTROL_STATUS,
	PRIVATE_IMP_UPDATED_DATE,
	PRIVATE_IMPLEMENTATION_DETAILS,
	RESPONSIBILITY,
	SHARED_IMP_UPDATED_DATE,
	SIGNIFICANT_CONTROL_CHANGE,
	SIGNIFICANT_CONTROL_CHANGE_DETAILS,
	SYSTEM_ID,
	TRACKING_ID
) COMMENT='CFACTS Parent level view of controls allocated to a system. Child views are joined to form a coherent record'
 as 
SELECT
APP_CFACTS.SHARED.SEC_VW_ENUM_ALLOCATION_STATUS.Value as Allocation_Status
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_ELEMENTS.Control_Element
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_ELEMENTS.Control_Element_Number
,APP_CFACTS.SHARED.SEC_VW_enum_Control_Family.Value as Control_Family
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Control_Name as Control_Name
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Control_Number as Control_Number
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Control_Number_Combo as Control_Number_Combo
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Helper_Control_Set_Version_Number_2 as Control_Set_Version_Number
,APP_CFACTS.SHARED.SEC_VW_ENUM_ALLOCATED__HYBRID_YES.value as hybrid_control
,APP_CFACTS.SHARED.SEC_VW_ENUM_INHERITABLE2.Value as Inheritable_by_other_systems
,timestamp_ntz_from_parts(to_date(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Last_ACT_Date, ' ', 1)), 
to_time(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Last_ACT_Date, ' ', 2))) as Last_ACT_Date
,timestamp_ntz_from_parts(to_date(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Inherited_Last_Assessment_Date, ' ', 1)), 
to_time(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Inherited_Last_Assessment_Date, ' ', 2))) as Last_Assessment_Date
,timestamp_ntz_from_parts(to_date(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Last_Pentest_Date, ' ', 1)), 
to_time(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Last_Pentest_Date, ' ', 2))) as Last_Pentest_Date
,timestamp_ntz_from_parts(to_date(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Last_SCA_Date, ' ', 1)), 
to_time(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Last_SCA_Date, ' ', 2))) as Last_SCA_Date
,APP_CFACTS.SHARED.SEC_VW_enum_Overall_Control_Status.Value as Overall_Control_Status
,timestamp_ntz_from_parts(to_date(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_Private_Allocated_Control_Information.Last_Updated_Date, ' ', 1)), 
to_time(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_Private_Allocated_Control_Information.Last_Updated_Date, ' ', 2))) as Private_Imp_Updated_Date
,APP_CFACTS.SHARED.SEC_VW_Private_Allocated_Control_Information.PRIVATE_IMPLEMENTATION_DETAILS -- 230622
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_ELEMENTS.Responsibility
,timestamp_ntz_from_parts(to_date(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Shared_Implementation_Details_Updated_, ' ', 1)), 
to_time(SPLIT_PART(APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Shared_Implementation_Details_Updated_, ' ', 2))) as Shared_Imp_Updated_Date
,APP_CFACTS.SHARED.SEC_VW_enum_GVL_Yes__No__Default_No.Value as Significant_Control_Change
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Significant_Control_Change_Details
,CORE.SYSTEMS.SYSTEM_ID as SYSTEM_ID
,APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.Tracking_ID as Tracking_ID
FROM APP_CFACTS.SHARED.SEC_VW_AUTHORIZATION_PACKAGE
JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_AUTHORIZATION_PACKAGE_X_AUTHORIZATION_PACKAGE_ALLOCATED_CONTROLS ON APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_AUTHORIZATION_PACKAGE_X_AUTHORIZATION_PACKAGE_ALLOCATED_CONTROLS.Authorization_Package_Allocated_Controls_ContentId = APP_CFACTS.SHARED.SEC_VW_AUTHORIZATION_PACKAGE.ContentId
JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS on APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId = APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_AUTHORIZATION_PACKAGE_X_AUTHORIZATION_PACKAGE_ALLOCATED_CONTROLS.Allocated_Controls_Authorization_Package_ContentId

JOIN CORE.SYSTEMS on CORE.SYSTEMS.SYSTEM_ID=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.FISMA_ID
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_ELEMENTS_ALLOCATED_CONTROLS_ALLOCATED_CONTROL_ELE_X_ALLOCATED_CONTROLS_ALLOCATED_CONTROL_ELEMENTS on APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_ELEMENTS_ALLOCATED_CONTROLS_ALLOCATED_CONTROL_ELE_X_ALLOCATED_CONTROLS_ALLOCATED_CONTROL_ELEMENTS.Allocated_Controls_Allocated_Control_Elements_ContentId
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_ELEMENTS on APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_ELEMENTS.ContentId=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_ELEMENTS_ALLOCATED_CONTROLS_ALLOCATED_CONTROL_ELE_X_ALLOCATED_CONTROLS_ALLOCATED_CONTROL_ELEMENTS.Allocated_Controls_Elements_Allocated_Controls_Allocated_Control_Ele_ContentId

LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_ALLOCATION_STATUS ON APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_ALLOCATION_STATUS.ParentContentId=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ENUM_ALLOCATION_STATUS ON APP_CFACTS.SHARED.SEC_VW_ENUM_ALLOCATION_STATUS.Id=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_ALLOCATION_STATUS.Value

LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_INHERITABLE ON APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_INHERITABLE.ParentContentId=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ENUM_INHERITABLE2 ON APP_CFACTS.SHARED.SEC_VW_ENUM_INHERITABLE2.Id=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_INHERITABLE.Value

LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_CONTROL_FAMILY ON APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_CONTROL_FAMILY.ParentContentId=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_enum_Control_Family ON APP_CFACTS.SHARED.SEC_VW_enum_Control_Family.Id=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_CONTROL_FAMILY.Value

LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_ALLOCATED__HYBRID_YES ON APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_ALLOCATED__HYBRID_YES.ParentContentId=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ENUM_ALLOCATED__HYBRID_YES ON APP_CFACTS.SHARED.SEC_VW_ENUM_ALLOCATED__HYBRID_YES.Id=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_ALLOCATED__HYBRID_YES.Value

LEFT JOIN APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_OVERALL_CONTROL_STATUS ON APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_OVERALL_CONTROL_STATUS.ParentContentId=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_enum_Overall_Control_Status ON APP_CFACTS.SHARED.SEC_VW_enum_Overall_Control_Status.ID=APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS_OVERALL_CONTROL_STATUS.Value

LEFT JOIN APP_CFACTS.SHARED.SEC_VW_Private_Allocated_Control_Information_Allocated_Controls_Private_x_Allocated_Controls_Private_Implementation_Details_CR ON APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId= APP_CFACTS.SHARED.SEC_VW_Private_Allocated_Control_Information_Allocated_Controls_Private_x_Allocated_Controls_Private_Implementation_Details_CR.Allocated_Controls_Private_Implementation_Details_CR_ContentId 
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_Private_Allocated_Control_Information ON  APP_CFACTS.SHARED.SEC_VW_Private_Allocated_Control_Information_Allocated_Controls_Private_x_Allocated_Controls_Private_Implementation_Details_CR.Private_Allocated_Control_Information_Allocated_Controls_Private_Implementatio_ContentId = APP_CFACTS.SHARED.SEC_VW_Private_Allocated_Control_Information.ContentId

LEFT JOIN APP_CFACTS.SHARED.SEC_VW_Allocated_Controls_Control_Standards_Significant_Control_Change on APP_CFACTS.SHARED.SEC_VW_ALLOCATED_CONTROLS_CONTROL_STANDARDS.ContentId=APP_CFACTS.SHARED.SEC_VW_Allocated_Controls_Control_Standards_Significant_Control_Change.ParentContentId
LEFT JOIN APP_CFACTS.SHARED.SEC_VW_enum_GVL_Yes__No__Default_No on APP_CFACTS.SHARED.SEC_VW_enum_GVL_Yes__No__Default_No.id=APP_CFACTS.SHARED.SEC_VW_Allocated_Controls_Control_Standards_Significant_Control_Change.Value
;