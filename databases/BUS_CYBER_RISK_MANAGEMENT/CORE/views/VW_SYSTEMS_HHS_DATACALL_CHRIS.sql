create or replace view VW_SYSTEMS_HHS_DATACALL_CHRIS(
	ACRONYM,
	ARCHER_TRACKING_ID,
	ATO_EXPIRATION_DATE,
	ATO_REVIEW_DATE,
	AUTH_COMMENTS,
	AUTH_DECISION,
	AUTHORIZATION_MEMO_SIGNED_DATE,
	AUTHORIZATION_PACKAGE,
	AWS_ACCOUNTIDS,
	BO_RECOMMENDATION_REVIEW_DATE,
	BO_REVIEW_DATE,
	BUSINESS_OWNER,
	CIO,
	CISO,
	CISO_REVIEW_DATE,
	CLOUD_SERVICE_PROVIDER,
	COMMONNAME,
	COMPONENT_ACRONYM,
	COMPONENT_DESCRIPTION,
	COMPONENT_NAME,
	COMPONENT_RISK_REPORTS_OVERSIGHT,
	CONTINGENCYEXPIRATIONDATE,
	CONTROL_SET_VERSION_NUMBER_SYSTEM_PROVID,
	CP_TEST_DATE,
	CP_TEST_RESULTS,
	CRA,
	CRA_REVIEW_DATE,
	CYBERVET,
	DATE_AUTH_MEMO_EXPIRES,
	DATE_AUTH_MEMO_SIGNED,
	DATEDELETED,
	DATEMODIFIED,
	DCISO,
	DIVISION_ACRONYM,
	DIVISION_DESCRIPTION,
	DIVISION_NAME,
	DSPC_REVIEW_DATE,
	DSPPO_REVIEW_DATE,
	E_AUTH_EXP_DATE,
	E_AUTH_LEVEL,
	E_AUTH_RISK_ASSESSMENT_DATE,
	FINANCIAL_SYSTEM,
	FIPS_199_AVAILABILITY_RATING,
	FIPS_199_CONFIDENTIALITY_RATING,
	FIPS_199_INTEGRITY_RATING,
	FIPS_199_OVERALL_IMPACT_RATING,
	FIRST_PUBLISHED_DATE,
	FISMA_SYSTEM,
	GROUP_ACRONYM,
	GROUP_DESCRIPTION,
	GROUP_NAME,
	HVA_SCORE,
	HVASTATUS,
	IN_CMS_CLOUD,
	INFORMATION_SYSTEM_TYPE,
	INSERT_DATE,
	IS_DATACENTER,
	IS_EXCLUDEFROMREPORTING,
	IS_HIGHRISKSYSTEM,
	IS_MARKETPLACE,
	IS_OA_READY,
	IS_OPERATIONALSYSTEM,
	IS_PHANTOMSYSTEM,
	IS_SECURITYHUB_ENABLED,
	ISRA_REVIEW_DATE,
	ISRA_STATUS,
	ISSO,
	ISSO_COUNT,
	ISSO_REVIEW_DATE,
	ISSO_SUBMISSION_DATE,
	ISSOCS,
	LAST_ACT_DATE,
	LAST_ACT_SCA_CAAT_PROCESSED_FILE_DATE,
	LAST_ACT_SCA_FINAL_REPORT_DATE,
	LAST_PENTEST_CAAT_PROCESSED_FILE_DATE,
	LAST_PENTEST_DATE,
	MEF,
	MEF_CONTEXT,
	MEFSTATUS,
	NEXT_REQUIRED_CP_TEST_DATE,
	OA_STATUS,
	OATO_CATEGORY,
	PACKAGE_TYPE,
	PIA_014,
	PIA_EXPIRATION_DATE,
	PII_PHI,
	PRIMARY_ISSO,
	PRIMARY_OPERATING_LOCATION,
	PRIMARY_OPERATING_LOCATION_ACRONYM,
	PRIMARY_OPERATING_LOCATION_ID,
	REASON_FOR_ATO_REQUEST,
	SCA,
	SCA_DATE,
	SDM,
	SOP_REVIEW_DATE,
	STE_DATE,
	SYSTEM_DESCRIPTION,
	SYSTEM_ID,
	TLC_PHASE,
	TOTALASSETS,
	TOTALPOAMWITHAPPROVEDRBD
) as
SELECT
s.ACRONYM
,s.ARCHER_TRACKING_ID
,s.ATO_EXPIRATION_DATE
,s.ATO_REVIEW_DATE
,s.AUTH_COMMENTS
,s.AUTH_DECISION
,s.AUTHORIZATION_MEMO_SIGNED_DATE
,s.AUTHORIZATION_PACKAGE
,substring(saa.AWS_ACCOUNTIDS,2) as AWS_ACCOUNTIDS 
,s.BO_RECOMMENDATION_REVIEW_DATE
,s.BO_REVIEW_DATE
,s.BUSINESS_OWNER
,s.CIO
,s.CISO
,s.CISO_REVIEW_DATE
,s.CLOUD_SERVICE_PROVIDER
,c.COMMONNAME
,s.COMPONENT_ACRONYM
,s.COMPONENT_DESCRIPTION
,s.COMPONENT_NAME
,s.COMPONENT_RISK_REPORTS_OVERSIGHT
,s.CONTINGENCYEXPIRATIONDATE
,s.CONTROL_SET_VERSION_NUMBER_SYSTEM_PROVID
,s.CP_TEST_DATE
,s.CP_TEST_RESULTS
,s.CRA
,s.CRA_REVIEW_DATE
,s.CYBERVET
,s.DATE_AUTH_MEMO_EXPIRES
,s.DATE_AUTH_MEMO_SIGNED
,s.DATEDELETED
,s.DATEMODIFIED
,s.DCISO
,s.DIVISION_ACRONYM
,s.DIVISION_DESCRIPTION
,s.DIVISION_NAME
,s.DSPC_REVIEW_DATE
,s.DSPPO_REVIEW_DATE
,s.E_AUTH_EXP_DATE
,s.E_AUTH_LEVEL
,s.E_AUTH_RISK_ASSESSMENT_DATE
,s.FINANCIAL_SYSTEM
,s.FIPS_199_AVAILABILITY_RATING
,s.FIPS_199_CONFIDENTIALITY_RATING
,s.FIPS_199_INTEGRITY_RATING
,s.FIPS_199_OVERALL_IMPACT_RATING
,s.FIRST_PUBLISHED_DATE
,s.FISMA_SYSTEM
,s.GROUP_ACRONYM
,s.GROUP_DESCRIPTION
,s.GROUP_NAME
,s.HVA_SCORE
,s.HVASTATUS
,s.IN_CMS_CLOUD
,s.INFORMATION_SYSTEM_TYPE
,s.INSERT_DATE
,s.IS_DATACENTER
,s.IS_EXCLUDEFROMREPORTING -- 230623 added back to support RPT schema, should no longer be used by Tableau
,s.IS_HIGHRISKSYSTEM
,s.IS_MARKETPLACE
,s.IS_OA_READY
,s.IS_OPERATIONALSYSTEM
,s.IS_PHANTOMSYSTEM -- 230623 added back to support RPT schema, should no longer be used by Tableau
,s.IS_SECURITYHUB_ENABLED
,s.ISRA_REVIEW_DATE
,s.ISRA_STATUS
,s.ISSO
,s.ISSO_COUNT
,s.ISSO_REVIEW_DATE
,s.ISSO_SUBMISSION_DATE
,s.ISSOCS
,s.LAST_ACT_DATE
,s.LAST_ACT_SCA_CAAT_PROCESSED_FILE_DATE -- 230428
,s.LAST_ACT_SCA_FINAL_REPORT_DATE
,s.LAST_PENTEST_CAAT_PROCESSED_FILE_DATE -- 230428
,s.LAST_PENTEST_DATE
,s.MEF
,s.MEF_CONTEXT
,s.MEFSTATUS
,s.NEXT_REQUIRED_CP_TEST_DATE
,s.OA_STATUS
,s.OATO_CATEGORY
,s.PACKAGE_TYPE
,s.PIA_014 -- 230621
,s.PIA_EXPIRATION_DATE
,s.PII_PHI
,s.PRIMARY_ISSO
,s.PRIMARY_OPERATING_LOCATION
,pol.ACRONYM as PRIMARY_OPERATING_LOCATION_ACRONYM
,s.PRIMARY_OPERATING_LOCATION_ID
,s.REASON_FOR_ATO_REQUEST
,s.SCA
,s.SCA_DATE
,s.SDM
,s.SOP_REVIEW_DATE
,s.STE_DATE
,s.SYSTEM_DESCRIPTION
,s.SYSTEM_ID
,s.TLC_PHASE
,coalesce(a.TOTALASSETS,0) as TOTALASSETS-- 231017 added coalesce
,s.TOTALPOAMWITHAPPROVEDRBD
FROM CORE.SYSTEMS s
LEFT OUTER JOIN CORE.SYSTEM_COMMONNAME c on c.SYSTEM_ID = s.SYSTEM_ID
LEFT OUTER JOIN CORE.SYSTEMS pol on pol.SYSTEM_ID = s.PRIMARY_OPERATING_LOCATION_ID
LEFT OUTER JOIN (select SYSTEM_ID,LISTAGG(distinct ', ' || AWS_ACCOUNTID , '') as AWS_ACCOUNTIDS FROM CORE.SYSTEMSAWSACCOUNTS group by SYSTEM_ID) saa on saa.SYSTEM_ID = s.SYSTEM_ID -- 230608
LEFT OUTER JOIN (select SYSTEM_ID,count(1) TotalAssets FROM CORE.ASSET where Is_Applicable = 1 group by SYSTEM_ID) a on a.SYSTEM_ID = s.SYSTEM_ID
;