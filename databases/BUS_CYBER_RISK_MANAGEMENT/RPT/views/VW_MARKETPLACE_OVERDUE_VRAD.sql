create or replace view VW_MARKETPLACE_OVERDUE_VRAD(
	COMPONENT_ACRONYM,
	SYSTEM_ID,
	FISMA_ID,
	ACRONYM,
	TLC_PHASE,
	OATO_CATEGORY,
	IS_MARKETPLACE,
	HVASTATUS,
	MEFSTATUS,
	DATA_CENTER_NAME,
	DATACENTER_ID,
	AWS_ACCOUNTIDS,
	CVE,
	DW_VUL_ID,
	TENABLEUUID,
	PLUGINID,
	FAMILYNAME,
	SIGNATURE,
	SOLUTION,
	FISMASEVERITY,
	CVSS3BASESCORE,
	EPSS,
	EPSS_FILTER,
	EPSS_PERCENTILE,
	MITIGATIONSTATUS,
	DATEMITIGATED,
	DAYSSINCEDISCOVERY,
	DAYSSINCEDISCOVERY_FILTER,
	OVERDUE_FILTER,
	IS_BOD,
	BODDUEDATE,
	SENSOR_FIRSTSEEN,
	SENSOR_LASTFOUND,
	EXPLOITAVAILABLE,
	DW_ASSET_ID,
	ASSET_ID_TATTOO,
	ENVIRONMENT,
	COMPUTER_TYPE,
	DEVICETYPE,
	IPV4,
	IPV6,
	HOSTNAME,
	FQDN,
	OS,
	OS_VERSION,
	MAC,
	NETBIOSNAME,
	BIOS_GUID,
	SOURCE_TOOL,
	VULNRISKTOLERANCE,
	REFRESH_DATE,
	CLOUD_ACCOUNT_ID
) COMMENT='provides overdue vulns and related asset details for Marketplace Systems only'
 as
select 
	COMPONENT_ACRONYM,
    SYSTEM_ID,
    FISMA_ID,
    ACRONYM,
    TLC_PHASE,
    OATO_CATEGORY,
    IS_MARKETPLACE,
    HVASTATUS,
    MEFSTATUS,
    DATA_CENTER_NAME,
    DATACENTER_ID,
    AWS_ACCOUNTIDS,
    CVE,
    DW_VUL_ID,
    TENABLEUUID,
    PLUGINID,
    FAMILYNAME,
    SIGNATURE,
    SOLUTION,
    FISMASEVERITY,
    CVSS3BASESCORE,
    EPSS,
    EPSS_FILTER,
    PERCENTILE EPSS_PERCENTILE,
    MITIGATIONSTATUS,
    DATEMITIGATED,
    DAYSSINCEDISCOVERY,
    DAYSSINCEDISCOVERY_FILTER,
    OVERDUE_FILTER,
    IS_BOD,
    BODDUEDATE,
    SENSOR_FIRSTSEEN,
    SENSOR_LASTFOUND,
    EXPLOITAVAILABLE,
    DW_ASSET_ID,
    ASSET_ID_TATTOO,
    ENVIRONMENT,
    COMPUTER_TYPE,
    DEVICETYPE,
    IPV4,
    IPV6,
    HOSTNAME,
    FQDN,
    OS,
    OS_VERSION,
    MAC,
    NETBIOSNAME,
    BIOS_GUID,
    SOURCE_TOOL,
    VULNRISKTOLERANCE,
    REFRESH_DATE,
    CLOUD_ACCOUNT_ID -- 241127 0846 CR1038
 from RPT.VW_ASSETDETAIL_ROLLING60DAYS asst
where is_marketplace = 1 and lower(MitigationStatus) in ('open', 'reopened')
and ((Asst.FISMASEVERITY = 'Critical' and Asst.DAYSSINCEDISCOVERY > 15) OR
    (Asst.FISMASEVERITY = 'High' and Asst.DAYSSINCEDISCOVERY > 30) OR
    (Asst.FISMASEVERITY = 'Medium' and Asst.DAYSSINCEDISCOVERY > 90) OR
    (Asst.FISMASEVERITY = 'Low' and Asst.DAYSSINCEDISCOVERY > 365))
;