create or replace view V_CRMP_PENTEST(
	"Acronym",
	"Component_Acronym",
	CAAT_ID,
	"Related_POA&Ms",
	"Source",
	"Test_Result",
	"SnapshotDate",
	"POA&M ID",
	"Days_Open",
	"Overall_Status",
	"Actual_Completion_Date",
	CAAT,
	"POA&M_Closed_Date",
	"Target",
	"Weakness_ID",
	"Weakness_Creation_Date",
	"Weakness_Risk_Level",
	"Weakness_Severity",
	"Date_Identified",
	SYSTEM_ID
) COMMENT='Used in other views to get Pentest data'
 as
SELECT 
s.Acronym as "Acronym"
,s.Component_Acronym as "Component_Acronym"
,caat.CAAT_ID as "CAAT_ID"
,caat.Related_POAMS as "Related_POA&Ms"
,caat.SOURCE_AUDIT_TYPE as "Source"
,caat.Test_Result as "Test_Result"
,r.REPORT_DATE as "SnapshotDate"
,ph.POAM_ID as "POA&M ID"
,ph.Days_Open as "Days_Open"
,ph.Overall_Status as "Overall_Status"
,ph.Actual_Completion_Date as "Actual_Completion_Date"
,ph.CAAT as "CAAT"
,ph.POAM_Closed_Date as "POA&M_Closed_Date"
,ph.Target as "Target"
,ph.Weakness_ID as "Weakness_ID"
,ph.Weakness_Creation_Date as "Weakness_Creation_Date"
,ph.Weakness_Risk_Level as "Weakness_Risk_Level"
,ph.Weakness_Severity as "Weakness_Severity"
,caat.Date_Identified as "Date_Identified" -- 230623 new in SDL
,s.SYSTEM_ID as "SYSTEM_ID" -- 230623 new in SDL
FROM TABLE(CORE.FN_CRM_GET_REPORT_ID(0)) r
JOIN CORE.CAATHist caat on caat.REPORT_ID = r.REPORT_ID
JOIN CORE.VW_SYSTEMS s on s.SYSTEM_ID = caat.SYSTEM_ID
LEFT OUTER JOIN CORE.VW_POAMHist ph on ph.REPORT_ID = r.REPORT_ID and ph.SYSTEM_ID = caat.SYSTEM_ID and ph.POAM_ID = caat.Related_POAMS
where caat.SOURCE_AUDIT_TYPE = 'Pentest';